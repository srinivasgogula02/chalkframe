<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>FitCheck</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <script src="https://unpkg.com/lucide@latest"></script>

    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;500;700&family=Inter:wght@400;600;900&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        safe: '#CCFF00', // Neon Lime
                        danger: '#FF0055', // Neon Red
                        primary: '#7000FF', // Electric Purple
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        display: ['Space Grotesk', 'sans-serif'],
                    },
                    animation: {
                        'scroll': 'scroll 20s linear infinite',
                        'blob': 'blob 7s infinite',
                        'bounce-slow': 'bounce 2s infinite',
                    },
                    keyframes: {
                        scroll: {
                            '0%': { transform: 'translateX(0)' },
                            '100%': { transform: 'translateX(-100%)' },
                        },
                        blob: {
                            '0%': { transform: 'translate(0px, 0px) scale(1)' },
                            '33%': { transform: 'translate(30px, -50px) scale(1.1)' },
                            '66%': { transform: 'translate(-20px, 20px) scale(0.9)' },
                            '100%': { transform: 'translate(0px, 0px) scale(1)' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background-color: #050505;
            color: white;
            font-family: 'Inter', sans-serif;
            overflow: hidden; /* App-like feel */
        }

        /* CYBER GRID BACKGROUND */
        .bg-grid {
            background-size: 40px 40px;
            background-image: linear-gradient(to right, rgba(255, 255, 255, 0.05) 1px, transparent 1px),
                              linear-gradient(to bottom, rgba(255, 255, 255, 0.05) 1px, transparent 1px);
            mask-image: linear-gradient(to bottom, black 40%, transparent 100%);
        }

        /* DARK MODE MAP FILTER (High Contrast) */
        .map-tiles-dark {
            filter: grayscale(100%) invert(100%) contrast(120%) brightness(90%);
        }

        /* Custom Map Popup Styling */
        .leaflet-popup-content-wrapper {
            background: rgba(5, 5, 5, 0.95); /* Dark background */
            color: white;
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            font-family: 'Space Grotesk', sans-serif;
            backdrop-filter: blur(8px);
        }
        .leaflet-popup-tip { background: rgba(5, 5, 5, 0.95); }
        .leaflet-popup-close-button { color: white !important; }

        /* View Management */
        .view {
            display: none;
            height: 100vh;
            width: 100vw;
            flex-direction: column;
            position: absolute;
            top: 0; left: 0; z-index: 10;
        }
        .view.active { display: flex; }

        /* Utilities */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* Remove default Leaflet Marker borders */
        .leaflet-div-icon {
            background: transparent;
            border: none;
        }
    </style>
</head>
<body>

    <div id="view-home" class="view active relative bg-[#050505]">
        <div class="absolute inset-0 bg-grid z-0 pointer-events-none"></div>
        <div class="absolute top-0 right-0 w-72 h-72 bg-purple-600 rounded-full mix-blend-screen filter blur-[100px] opacity-20 animate-blob"></div>
        <div class="absolute bottom-0 left-0 w-72 h-72 bg-blue-600 rounded-full mix-blend-screen filter blur-[100px] opacity-20 animate-blob animation-delay-2000"></div>

        <header class="flex justify-between items-center p-6 z-10">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 rounded-full bg-gradient-to-tr from-safe to-green-500 p-[2px]">
                    <img src="https://images.unsplash.com/photo-1534528741775-53994a69daeb?w=100&h=100&fit=crop" class="rounded-full w-full h-full object-cover border-2 border-black" alt="Profile">
                </div>
                <div>
                    <h3 class="text-sm font-bold text-gray-400">Welcome back,</h3>
                    <h2 class="text-lg font-bold font-display leading-none">Srinivas</h2>
                </div>
            </div>
            <div class="flex gap-2">
                <div class="flex items-center gap-1 bg-white/10 px-3 py-1 rounded-full backdrop-blur-md border border-white/5">
                    <i data-lucide="map-pin" class="w-3 h-3 text-safe"></i>
                    <span class="text-xs font-bold">Hyd</span>
                </div>
            </div>
        </header>

        <main class="flex-1 flex flex-col px-6 z-10 overflow-y-auto no-scrollbar">
            
            <div class="mb-8 mt-4">
                <h1 class="text-6xl font-black font-display tracking-tighter italic text-transparent bg-clip-text bg-gradient-to-r from-white via-gray-200 to-gray-600">
                    FitCheck.
                </h1>
                <p class="text-gray-400 text-sm font-bold tracking-widest uppercase mt-2 ml-1">Don't clone. Coordinate.</p>
            </div>

            <div class="grid grid-cols-1 gap-5 mb-10">
                <button onclick="goToInput('check')" class="group relative h-44 w-full rounded-[2.5rem] bg-neutral-900 border border-white/10 overflow-hidden transition-all active:scale-95 shadow-2xl shadow-purple-900/20">
                    <div class="absolute inset-0 bg-[radial-gradient(ellipse_at_top_right,_var(--tw-gradient-stops))] from-purple-900/40 via-neutral-900/0 to-neutral-900/0 group-hover:opacity-100 opacity-50 transition-opacity"></div>
                    <div class="relative z-10 h-full flex flex-row items-center justify-between p-8">
                        <div class="text-left">
                            <h2 class="text-3xl font-black font-display text-white italic">VIBE CHECK</h2>
                            <p class="text-gray-300 font-medium text-sm mt-1">Scan the streets before you buy.</p>
                        </div>
                        <div class="w-16 h-16 bg-white rounded-full flex items-center justify-center text-black shadow-[0_0_30px_rgba(255,255,255,0.2)] group-hover:scale-110 transition-transform">
                            <i data-lucide="radar" class="w-8 h-8"></i>
                        </div>
                    </div>
                </button>

                <button onclick="goToInput('add')" class="group relative h-24 w-full rounded-[2rem] border-2 border-dashed border-neutral-800 hover:border-neutral-600 transition-colors active:scale-95 bg-black/20 backdrop-blur-sm">
                    <div class="h-full flex flex-row items-center justify-center gap-3">
                        <div class="bg-neutral-800 p-2 rounded-full">
                             <i data-lucide="plus" class="w-5 h-5 text-gray-400"></i>
                        </div>
                        <span class="text-md font-bold text-gray-400 group-hover:text-white transition-colors">Add to rotation</span>
                    </div>
                </button>
            </div>

            <div class="mb-6">
                <div class="flex justify-between items-center mb-5">
                    <h3 class="text-xl font-black font-display italic">ðŸ”¥ Trending nearby</h3>
                    <div class="flex items-center gap-1 px-2 py-1 bg-danger/10 border border-danger/20 rounded-full">
                        <div class="w-2 h-2 bg-danger rounded-full animate-pulse"></div>
                        <span class="text-[10px] text-danger font-bold uppercase tracking-wider">High Risk</span>
                    </div>
                </div>
                
                <div class="flex gap-4 overflow-x-auto no-scrollbar pb-4 pl-1">
                    <div onclick="quickTest('https://nike.com/dunk-panda', 'Panda Dunks')" class="flex-shrink-0 w-40 h-56 bg-neutral-900 rounded-3xl overflow-hidden border border-white/5 relative active:scale-95 transition-all cursor-pointer group hover:border-danger/50">
                        <img src="https://images.unsplash.com/photo-1552346154-21d32810aba3?w=400&h=500&fit=crop" class="w-full h-full object-cover opacity-70 group-hover:opacity-100 transition-opacity duration-500">
                        <div class="absolute inset-0 bg-gradient-to-t from-black via-black/20 to-transparent"></div>
                        <div class="absolute bottom-0 left-0 w-full p-4">
                            <p class="text-sm font-bold text-white leading-tight">Nike Dunk Low Panda</p>
                            <p class="text-xs text-danger font-bold mt-1">54 owners nearby</p>
                        </div>
                         <div class="absolute top-3 right-3 bg-black/50 backdrop-blur-md p-1.5 rounded-full opacity-0 group-hover:opacity-100 transition-opacity">
                            <i data-lucide="radar" class="w-4 h-4 text-white"></i>
                        </div>
                    </div>

                    <div onclick="quickTest('https://stussy.com/8-ball', 'Stussy 8 Ball')" class="flex-shrink-0 w-40 h-56 bg-neutral-900 rounded-3xl overflow-hidden border border-white/5 relative active:scale-95 transition-all cursor-pointer group hover:border-danger/50">
                        <img src="https://images.unsplash.com/photo-1578768079052-aa76e52ff62e?w=400&h=500&fit=crop" class="w-full h-full object-cover opacity-70 group-hover:opacity-100 transition-opacity duration-500">
                        <div class="absolute inset-0 bg-gradient-to-t from-black via-black/20 to-transparent"></div>
                        <div class="absolute bottom-0 left-0 w-full p-4">
                            <p class="text-sm font-bold text-white leading-tight">Stussy 8-Ball Fleece</p>
                            <p class="text-xs text-danger font-bold mt-1">12 owners nearby</p>
                        </div>
                    </div>
                    
                    <div onclick="quickTest('https://brand.com/rare-piece', 'Rare Vintage')" class="flex-shrink-0 w-40 h-56 bg-neutral-900 rounded-3xl overflow-hidden border border-white/5 relative active:scale-95 transition-all cursor-pointer group hover:border-safe/50">
                        <img src="https://images.unsplash.com/photo-1515886657613-9f3515b0c78f?w=400&h=500&fit=crop" class="w-full h-full object-cover opacity-70 group-hover:opacity-100 transition-opacity duration-500">
                        <div class="absolute inset-0 bg-gradient-to-t from-black via-black/20 to-transparent"></div>
                        <div class="absolute bottom-0 left-0 w-full p-4">
                            <p class="text-sm font-bold text-white leading-tight">Archive Raf Simons</p>
                            <p class="text-xs text-safe font-bold mt-1 flex items-center gap-1">
                                <i data-lucide="shield-check" class="w-3 h-3"></i> Safe to cop
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <div class="bg-neutral-900/50 backdrop-blur-xl border-t border-white/5 py-3 overflow-hidden">
            <div class="flex animate-scroll whitespace-nowrap gap-8 items-center">
                <div class="flex items-center gap-2 text-xs font-medium text-gray-400">
                    <div class="w-2 h-2 bg-safe rounded-full animate-pulse"></div> LIVE:
                </div>
                <div class="flex items-center gap-2 text-xs text-gray-400">
                    <img src="https://randomuser.me/api/portraits/men/1.jpg" class="w-6 h-6 rounded-full grayscale border border-white/10">
                    <span class="text-white font-bold">Arjun</span> just copped <span class="text-safe font-bold">Yeezy Slides</span>
                </div>
                <div class="flex items-center gap-2 text-xs text-gray-400">
                    <img src="https://randomuser.me/api/portraits/women/2.jpg" class="w-6 h-6 rounded-full grayscale border border-white/10">
                    <span class="text-white font-bold">Priya</span> stashed <span class="text-safe font-bold">Essentials Hoodie</span>
                </div>
                <div class="flex items-center gap-2 text-xs text-gray-400">
                    <img src="https://randomuser.me/api/portraits/men/3.jpg" class="w-6 h-6 rounded-full grayscale border border-white/10">
                    <span class="text-white font-bold">Rahul</span> got a <span class="text-danger font-bold">DUPLICATE ALERT</span> on Jordan 1s
                </div>
                <div class="flex items-center gap-2 text-xs text-gray-400">
                    <img src="https://randomuser.me/api/portraits/men/1.jpg" class="w-6 h-6 rounded-full grayscale border border-white/10">
                    <span class="text-white font-bold">Arjun</span> just copped <span class="text-safe font-bold">Yeezy Slides</span>
                </div>
            </div>
        </div>
    </div>

    <div id="view-input" class="view bg-[#050505] p-6">
        <div class="absolute inset-0 bg-grid z-0 pointer-events-none opacity-50"></div>
        
        <div class="relative z-10 h-full flex flex-col">
             <button onclick="goHome()" class="mb-8 w-12 h-12 flex items-center justify-center bg-neutral-900 border border-white/10 rounded-full active:scale-90 transition text-white">
                <i data-lucide="arrow-left" class="w-6 h-6"></i>
            </button>

            <h2 id="input-title" class="text-5xl font-black font-display mb-3 tracking-tight text-white italic leading-[0.9]">Title</h2>
            <p id="input-desc" class="text-gray-400 mb-10 font-bold text-lg">Description</p>

            <div class="relative mb-8 group">
                <div class="absolute -inset-0.5 bg-gradient-to-r from-safe to-primary rounded-2xl blur opacity-20 group-focus-within:opacity-50 transition duration-500"></div>
                <div class="relative flex items-center">
                    <input 
                        id="url-input" 
                        type="url" 
                        placeholder="Paste product URL..." 
                        class="w-full bg-neutral-900 border-2 border-neutral-800 rounded-2xl p-6 pl-14 text-lg font-bold placeholder-neutral-600 focus:outline-none focus:border-white transition-colors text-white relative z-10"
                        oninput="checkInputState()"
                    >
                    <div class="absolute left-5 top-1/2 transform -translate-y-1/2 z-20 text-neutral-500">
                        <i data-lucide="link-2" class="w-6 h-6"></i>
                    </div>
                </div>
            </div>

            <div class="mb-auto">
                <p class="text-[10px] font-black text-gray-600 uppercase tracking-[0.2em] mb-4 pl-2">Demo Data (Tap to test)</p>
                <div class="flex flex-wrap gap-3">
                    <button onclick="fillInput('https://nike.com/dunk-panda')" class="flex items-center gap-2 px-4 py-3 bg-neutral-900 border border-danger/30 hover:border-danger/80 text-white text-xs rounded-xl font-bold active:scale-95 transition">
                        <div class="w-2 h-2 bg-danger rounded-full animate-pulse"></div> Panda Dunks (Fail)
                    </button>
                    <button onclick="fillInput('https://stussy.com/8-ball')" class="flex items-center gap-2 px-4 py-3 bg-neutral-900 border border-danger/30 hover:border-danger/80 text-white text-xs rounded-xl font-bold active:scale-95 transition">
                         <div class="w-2 h-2 bg-danger rounded-full animate-pulse"></div> Stussy 8-Ball (Fail)
                    </button>
                    <button onclick="fillInput('https://new.com/safe')" class="flex items-center gap-2 px-4 py-3 bg-neutral-900 border border-safe/30 hover:border-safe/80 text-white text-xs rounded-xl font-bold active:scale-95 transition">
                        <div class="w-2 h-2 bg-safe rounded-full"></div> Rare Item (Pass)
                    </button>
                </div>
            </div>

            <button 
                id="action-btn"
                onclick="handleAction()"
                disabled
                class="w-full py-6 rounded-[1.5rem] text-2xl font-black font-display italic transition-all active:scale-95 disabled:opacity-50 disabled:scale-100 disabled:bg-neutral-800 disabled:text-neutral-600 uppercase tracking-wider"
            >
                Action
            </button>
        </div>
    </div>

    <div id="view-result" class="view" style="padding: 0;">
        <div id="map" class="absolute inset-0 z-0 h-full w-full bg-neutral-900"></div>

        <div class="relative z-10 flex flex-col h-full pointer-events-none w-full justify-between p-6">
            
            <div class="pointer-events-auto flex justify-between items-start">
                <button onclick="goHome()" class="w-12 h-12 flex items-center justify-center bg-black/60 backdrop-blur-xl text-white rounded-full border border-white/10 active:scale-90 transition shadow-lg">
                    <i data-lucide="x" class="w-6 h-6"></i>
                </button>
                <div class="px-4 py-2 bg-black/60 backdrop-blur-xl rounded-full border border-white/10 text-white font-bold text-xs flex items-center gap-2 shadow-lg">
                    <div class="w-2 h-2 bg-safe rounded-full animate-pulse"></div>
                    Live Map View
                </div>
            </div>

            <div class="pointer-events-auto w-full">
                <div id="result-card" class="w-full rounded-[2.5rem] p-8 text-center backdrop-blur-2xl border-2 shadow-2xl transition-all duration-500 transform translate-y-0">
                    
                    <div id="result-icon-container" class="mx-auto w-24 h-24 rounded-full flex items-center justify-center mb-6 shadow-2xl border-[5px]">
                        <i id="result-icon" data-lucide="map-pin" class="w-12 h-12"></i>
                    </div>

                    <h2 id="result-title" class="text-5xl font-black font-display text-white mb-3 uppercase italic tracking-tighter leading-none">
                        Alert
                    </h2>
                    <p id="result-desc" class="text-white/80 mb-8 text-lg font-bold leading-tight">
                        Description
                    </p>

                    <button 
                        id="result-btn"
                        onclick="goHome()"
                        class="w-full py-5 rounded-2xl font-black font-display text-xl hover:scale-[1.02] active:scale-95 transition-all uppercase italic tracking-wider shadow-xl"
                    >
                        Close
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <script>
        // --- 1. SETUP & DATA ---
        let currentMode = ''; 
        let mapInstance = null;
        // Using a central location for demo purposes
        let userLocation = [17.3850, 78.4867]; // Hyderabad coords

        // Test Data: Users and their closets
        const MOCK_DB = [
            { id: 1, name: "Kartik", lat: 17.3850, lng: 78.4867, closet: ["https://nike.com/dunk-panda", "https://uniqlo.com/airism"] },
            { id: 2, name: "Sneha", lat: 17.3880, lng: 78.4900, closet: ["https://nike.com/dunk-panda", "https://zara.com/top"] },
            { id: 3, name: "Rohan", lat: 17.3820, lng: 78.4840, closet: ["https://stussy.com/8-ball"] },
            { id: 4, name: "Vikram", lat: 17.3900, lng: 78.4800, closet: ["https://nike.com/dunk-panda", "https://stussy.com/8-ball"] },
            { id: 5, name: "Ananya", lat: 17.3750, lng: 78.4950, closet: ["https://uniqlo.com/airism"] },
        ];

        // --- 2. NAVIGATION & VIEW STATE ---
        function switchView(viewId) {
            document.querySelectorAll('.view').forEach(el => el.classList.remove('active'));
            document.getElementById(viewId).classList.add('active');
            lucide.createIcons(); // Refresh icons on view change
        }

        function goHome() {
            // Reset input field when going home
            document.getElementById('url-input').value = '';
            switchView('view-home');
        }

        // Shortcut function for home screen carousel items
        function quickTest(url, name) {
            currentMode = 'check';
            // Skip the input screen and go straight to checking
            performVibeCheck(url);
        }

        // --- 3. INPUT SCREEN LOGIC ---
        function goToInput(mode) {
            currentMode = mode;
            const title = document.getElementById('input-title');
            const desc = document.getElementById('input-desc');
            const btn = document.getElementById('action-btn');

            // Customize UI based on mode (Add vs Check)
            if (mode === 'check') {
                title.innerText = "Don't clone.";
                desc.innerText = "Paste link. Scan the streets.";
                btn.innerText = "SCAN NOW";
            } else {
                title.innerText = "Secure the bag.";
                desc.innerText = "Add new heat to your rotation.";
                btn.innerText = "STASH IT";
            }
            
            checkInputState(); // Ensure button state is correct
            switchView('view-input');
        }

        // Enable/Disable button based on input
        function checkInputState() {
            const input = document.getElementById('url-input');
            const btn = document.getElementById('action-btn');
            
            if(input.value.length > 0) {
                btn.disabled = false;
                // Different styles for different modes
                if(currentMode === 'check') {
                    btn.className = "w-full py-6 rounded-[1.5rem] text-2xl font-black font-display italic transition-all active:scale-95 uppercase tracking-wider bg-safe text-black shadow-[0_0_30px_rgba(204,255,0,0.4)]";
                } else {
                    btn.className = "w-full py-6 rounded-[1.5rem] text-2xl font-black font-display italic transition-all active:scale-95 uppercase tracking-wider bg-white text-black shadow-[0_0_30px_rgba(255,255,255,0.4)]";
                }
            } else {
                // Disabled state
                btn.disabled = true;
                btn.className = "w-full py-6 rounded-[1.5rem] text-2xl font-black font-display italic transition-all active:scale-95 disabled:opacity-50 disabled:scale-100 disabled:bg-neutral-800 disabled:text-neutral-600 uppercase tracking-wider";
            }
        }

        // Helper for test data chips
        function fillInput(url) {
            const input = document.getElementById('url-input');
            input.value = url;
            checkInputState();
        }


        // --- 4. CORE BUSINESS LOGIC ---
        function handleAction() {
            const url = document.getElementById('url-input').value;
            if(!url) return;

            if(currentMode === 'add') {
                // Mock success feedback for "Add" mode
                const btn = document.getElementById('action-btn');
                btn.innerText = "STASHED! âœ¨";
                btn.style.backgroundColor = '#CCFF00';
                 // Simulate delay before returning home
                setTimeout(() => {
                     goHome(); 
                     btn.innerText = "STASH IT"; // Reset text
                }, 1200);
            } else {
                // Perform the check
                performVibeCheck(url);
            }
        }

        function performVibeCheck(url) {
            // Search database for matches
            const matches = MOCK_DB.filter(user => user.closet.includes(url));
            const isSafe = matches.length === 0;

            // Update the result card UI based on findings
            renderResultCard(isSafe, matches);
            
            // Show the map view
            switchView('view-result');
            
            // Initialize Leaflet map (must be done after container is visible)
            // Small timeout to ensure DOM transition doesn't break map sizing
            setTimeout(() => {
                initMap(isSafe, matches);
            }, 50);
        }

        // Updates the bottom card in the map view
        function renderResultCard(isSafe, matches) {
            const card = document.getElementById('result-card');
            const iconContainer = document.getElementById('result-icon-container');
            const icon = document.getElementById('result-icon');
            const title = document.getElementById('result-title');
            const desc = document.getElementById('result-desc');
            const btn = document.getElementById('result-btn');

            if(isSafe) {
                // --- SAFE TO COP STATE ---
                card.className = "w-full rounded-[2.5rem] p-8 text-center backdrop-blur-2xl border-2 shadow-[0_0_50px_rgba(204,255,0,0.3)] transition-all duration-500 transform translate-y-0 bg-neutral-900/80 border-safe/30";
                
                iconContainer.className = "mx-auto w-24 h-24 rounded-full flex items-center justify-center mb-6 shadow-[0_0_40px_rgba(204,255,0,0.6)] bg-safe text-black border-[5px] border-black/50";
                icon.setAttribute('data-lucide', 'badge-check');
                
                title.innerText = "SAFE TO COP";
                title.className = "text-5xl font-black font-display text-safe mb-3 uppercase italic tracking-tighter leading-none drop-shadow-[0_0_10px_rgba(204,255,0,0.5)]";
                
                desc.innerHTML = "Zero matches found nearby.<br>You're strictly 1-of-1. Secure it.";
                
                btn.innerText = "CLAIM IT NOW";
                btn.style.backgroundColor = '#CCFF00';
                btn.style.color = 'black';
                btn.className = "w-full py-5 rounded-2xl font-black font-display text-xl hover:scale-[1.02] active:scale-95 transition-all uppercase italic tracking-wider shadow-[0_0_30px_rgba(204,255,0,0.5)]";
            } else {
                // --- DUPLICATE ALERT STATE ---
                card.className = "w-full rounded-[2.5rem] p-8 text-center backdrop-blur-2xl border-2 shadow-[0_0_50px_rgba(255,0,85,0.3)] transition-all duration-500 transform translate-y-0 bg-neutral-900/90 border-danger/30";
                
                iconContainer.className = "mx-auto w-24 h-24 rounded-full flex items-center justify-center mb-6 shadow-[0_0_40px_rgba(255,0,85,0.6)] bg-danger text-white border-[5px] border-black/50";
                icon.setAttribute('data-lucide', 'siren');
                
                title.innerText = "DUPLICATE ALERT";
                title.className = "text-5xl font-black font-display text-danger mb-3 uppercase italic tracking-tighter leading-none drop-shadow-[0_0_10px_rgba(255,0,85,0.5)]";
                
                desc.innerHTML = `Abort Mission. <b>${matches.length} people</b> near you already own this.`;
                
                btn.innerText = "FIND SOMETHING ELSE";
                btn.style.backgroundColor = '#FF0055';
                btn.style.color = 'white';
                 btn.className = "w-full py-5 rounded-2xl font-black font-display text-xl hover:scale-[1.02] active:scale-95 transition-all uppercase italic tracking-wider shadow-[0_0_30px_rgba(255,0,85,0.5)]";
            }
            // Important: Refresh icons after changing data-lucide attributes
            lucide.createIcons();
        }

        // --- 5. MAP INITIALIZATION & MARKERS ---
        function initMap(isSafe, matches) {
            // Clean up previous map instance if it exists
            if (mapInstance) {
                mapInstance.remove();
                mapInstance = null;
            }

            // Create fresh map instance
            mapInstance = L.map('map', {
                zoomControl: false, // Hide default controls for cleaner UI
                attributionControl: false,
                zoomAnimation: true
            }).setView(userLocation, 15); // Zoom level 15 for street view feel

            // Add OpenStreetMap tiles with custom Dark CSS Filter
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                maxZoom: 19,
                className: 'map-tiles-dark' // Applies the grayscale/invert filter
            }).addTo(mapInstance);

            // 1. Add Current User Marker (White Dot)
            const userIcon = L.divIcon({
                className: '', // Clear default class
                // Custom HTML for the marker
                html: `
                <div class="relative flex items-center justify-center w-12 h-12">
                    <div class="absolute w-4 h-4 bg-white rounded-full z-10 border-[3px] border-black shadow-[0_0_20px_rgba(255,255,255,0.8)]"></div>
                    <div class="absolute w-full h-full bg-white/30 rounded-full animate-ping opacity-70"></div>
                </div>
                `,
                iconSize: [48, 48], // Match div size
                iconAnchor: [24, 24] // Center anchor
            });
            L.marker(userLocation, {icon: userIcon}).addTo(mapInstance);

            // 2. If Duplicates found, plot EMOJI markers
            if (!isSafe) {
                matches.forEach(user => {
                    // Add slight random jitter so markers don't perfectly overlap
                    // if users have identical coordinates in mock data
                    const lat = user.lat + (Math.random() - 0.5) * 0.003;
                    const lng = user.lng + (Math.random() - 0.5) * 0.003;

                    // EMOJI MARKER CONFIGURATION
                    const emojiIcon = L.divIcon({
                        className: '',
                        // Using Tailwind utility classes right in the HTML string for styling
                        html: `<div class="flex items-center justify-center text-4xl drop-shadow-[0_0_15px_rgba(255,0,85,1)] animate-bounce-slow relative z-20" style="animation-delay: ${Math.random()}s">ðŸ¤¡</div>`,
                        iconSize: [40, 40],
                        iconAnchor: [20, 40], // Anchor at bottom center of emoji
                        popupAnchor: [0, -40] // Popup opens above emoji
                    });
                    
                    // Popup Content
                    const popupContent = `
                        <div class="text-left p-1">
                            <div class="flex items-center gap-2 mb-1">
                                <span class="text-lg">ðŸ¤¡</span>
                                <h3 class="font-black text-lg uppercase italic text-danger">${user.name}</h3>
                            </div>
                             <p class="text-xs font-bold text-gray-300 leading-tight">Already owns this item.</p>
                        </div>
                    `;

                    // Add marker with popup to map
                    L.marker([lat, lng], {icon: emojiIcon})
                        .addTo(mapInstance)
                        .bindPopup(popupContent);
                });
            }

            // Fly animation to the center location once map loads
            mapInstance.invalidateSize();
            mapInstance.flyTo(userLocation, 15, {
                animate: true,
                duration: 1.5
            });
        }

        // Initial Icon Load
        lucide.createIcons();
    </script>
</body>
</html>
